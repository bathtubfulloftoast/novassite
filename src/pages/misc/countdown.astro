---
import '/src/styles/colors.css';
import '/src/styles/misc.css';
---
<head>
<title>Countdown</title>

<meta content="CountDown" property="og:title" />
<meta content="arbitrary countdown to some random time" property="og:description" />

<style is:global>
.center-screen h1 {
font-size:7.5vw;
}
</style>
</head>

<body>
<div class="center-screen">
<form id="dselect">
<label>Countdown Date:</label>
<input type="date" name="date" required="true"></input>
<input type="time" name="time" required="true"></input>
<input type="submit"></input>
<p id="error"></p>
</form>
</div>
</body>

<script>
let hash = window.location.hash;
hash = hash.substring(1); 
hash = decodeURI(hash);

const time = new Date(hash);
var now = new Date();


const timer = document.createElement("h1");
timer.innerHTML = "0d 0h 0m 0s";

const wrapper = document.createElement("div");
wrapper.className = "center-screen";
if (isNaN(time)) {
document.getElementById("error").remove();
}
else if (time < now) {
document.getElementById("error").innerHTML="please select a time in the future";
} // shit code dont do this, however its easier for me to read and the compiler handles this bullshit so :)
else if(hash) {
document.body.innerHTML="";
document.body.appendChild(wrapper);
wrapper.appendChild(timer);

var x = setInterval(function() {
  now = new Date();// this is also crap but im just lazy and it doesnt matter so :)

  var distance = time- now;
    
  // Time calculations for days, hours, minutes and seconds
  var weeks = Math.floor(distance / (1000 * 60 * 60 * 24 * 7));
  var days = Math.floor(distance % (1000 * 60 * 60 * 24 * 7) / (1000 * 60 * 60 * 24));
  var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
  var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
  var seconds = Math.floor((distance % (1000 * 60)) / 1000);
    
// Output the result in an element with id="demo"


// again this is shit dont put code in if else hell
const minute = 1000* 60;
const hour = minute * 60;
const day = hour * 24;
const week = day * 7;

if (distance <= minute) {
timer.innerHTML = seconds + "s ";
} else if (distance <= hour) {
timer.innerHTML = minutes + "m " + seconds + "s ";
} else if (distance <= day ) {
timer.innerHTML = hours + "h " + minutes + "m " + seconds + "s ";
} else if (distance <= week) {
timer.innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
} else {
timer.innerHTML = weeks + "w " + days + "d " + hours + "h " + minutes + "m " + seconds + "s "; 
}
  
    
  // If the count down is over, write some text 
  if (distance < 0) {
    clearInterval(x);
    timer.innerHTML = "Time Over";
  }
}, 1000);

}
</script>

<script>
const now = new Date();

const date = document.getElementById("dselect");
date.date.valueAsDate = now;

date.time.value = now.toString().substring(16,21);
date.addEventListener("submit", async function(event) {
event.preventDefault();
window.open(`#${date.date.value} ${date.time.value}`, '_top');
await location.reload();

});

window.onhashchange = function() {
location.reload();
}
</script>
